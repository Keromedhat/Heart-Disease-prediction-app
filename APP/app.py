# -*- coding: utf-8 -*-
"""app.py

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1kYd3sjFSRiMDeU7LcSAFm510XgK6vPgf
"""
import streamlit as st
import joblib
import numpy as np
import plotly.graph_objects as go

# ---------------- Page Config ----------------
st.set_page_config(page_title="Heart Disease Prediction App", layout="centered")

# ---------------- Title ----------------
st.markdown("## ğŸ«€ Heart Disease Prediction App")
st.markdown("Enter the patient's details below:")

# ---------------- Load Model ----------------
def load_model():
    model = joblib.load("Models/best_xgboost_model.pkl")
    scaler = joblib.load("Models/scaler.pkl")
    return model, scaler

model, scaler = load_model()
# ---------------- Input Section ----------------
st.markdown("### ğŸ§â€â™‚ï¸ Patient Information")
col1, col2 = st.columns(2)

with col1:
    age = st.number_input("ğŸ‚ Age | Ø§Ù„Ø¹Ù…Ø± (Normal: 20â€“60 years)", 1, 120, 50)

    sex = st.selectbox("ğŸš» Gender | Ø§Ù„Ø¬Ù†Ø³ (0 = Female | 1 = Male)", [0, 1],
                       format_func=lambda x: "Ø£Ù†Ø«Ù‰ (Female)" if x == 0 else "Ø°ÙƒØ± (Male)")

    cp = st.selectbox("ğŸ’” Chest Pain Type | Ù†ÙˆØ¹ Ø£Ù„Ù… Ø§Ù„ØµØ¯Ø± (0=Normal â†’ 3=Worst)", [0, 1, 2, 3],
                      format_func=lambda x: {
                          0: "0 - Typical Angina | Ø°Ø¨Ø­Ø© ØµØ¯Ø±ÙŠØ© Ø·Ø¨ÙŠØ¹ÙŠØ©",
                          1: "1 - Atypical Angina | Ø°Ø¨Ø­Ø© ØºÙŠØ± Ù†Ù…ÙˆØ°Ø¬ÙŠØ©",
                          2: "2 - Non-anginal Pain | Ø£Ù„Ù… ØºÙŠØ± Ù‚Ù„Ø¨ÙŠ",
                          3: "3 - Asymptomatic | Ø¨Ø¯ÙˆÙ† Ø£Ø¹Ø±Ø§Ø¶"
                      }[x])

    trestbps = st.number_input("ğŸ©º Resting BP | Ø¶ØºØ· Ø§Ù„Ø¯Ù… Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø±Ø§Ø­Ø© (Normal: 90â€“120 mmHg)", 80, 200, 120)

    chol = st.number_input("ğŸ’‰ Serum Cholesterol | Ø§Ù„ÙƒÙˆÙ„ÙŠØ³ØªØ±ÙˆÙ„ (Normal: < 200 mg/dl)", 100, 600, 200)

    fbs = st.selectbox("ğŸ©¸ Fasting Blood Sugar | Ø§Ù„Ø³ÙƒØ± Ø§Ù„ØµØ§Ø¦Ù… (0 <120 mg/dl | 1 >120 mg/dl)", [0, 1],
                       format_func=lambda x: "0 - Ø·Ø¨ÙŠØ¹ÙŠ (<120)" if x == 0 else "1 - Ù…Ø±ØªÙØ¹ (>120)")

with col2:
    restecg = st.selectbox("ğŸ“ˆ Resting ECG | ØªØ®Ø·ÙŠØ· Ø§Ù„Ù‚Ù„Ø¨ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø±Ø§Ø­Ø© (0=Normal)", [0, 1, 2],
                           format_func=lambda x: {
                               0: "0 - Ø·Ø¨ÙŠØ¹ÙŠ (Normal)",
                               1: "1 - ST-T abnormality (Ø®Ù„Ù„ Ø¨Ø³ÙŠØ·)",
                               2: "2 - LVH (ØªØ¶Ø®Ù… Ø§Ù„Ø¨Ø·ÙŠÙ† Ø§Ù„Ø£ÙŠØ³Ø±)"
                           }[x])

    thalch = st.number_input("â¤ï¸ Max Heart Rate | Ø£Ù‚ØµÙ‰ Ù…Ø¹Ø¯Ù„ Ù†Ø¨Ø¶ (Normal: 100â€“200 bpm)", 60, 220, 150)

    exang = st.selectbox("ğŸƒ Exercise Angina | Ø£Ù„Ù… Ù…Ø¹ Ø§Ù„ØªÙ…Ø±ÙŠÙ† (0 = No | 1 = Yes)", [0, 1],
                         format_func=lambda x: "0 - Ù„Ø§ ÙŠÙˆØ¬Ø¯ (No)" if x == 0 else "1 - ÙŠÙˆØ¬Ø¯ (Yes)")

    oldpeak = st.number_input("ğŸ“‰ Oldpeak (ST Depression) | Ø§Ù†Ø®ÙØ§Ø¶ ST (Normal: 0.0â€“2.0)", 0.0, 6.0, 1.0)

    slope = st.selectbox("ğŸ“Š Slope of ST Segment | Ù…ÙŠÙ„ Ù…Ù†Ø­Ù†Ù‰ ST (0 = Upsloping Ø£ÙØ¶Ù„)", [0, 1, 2],
                         format_func=lambda x: {
                             0: "0 - ØµØ§Ø¹Ø¯ (Upsloping)",
                             1: "1 - Ù…Ø³ØªÙˆÙ (Flat)",
                             2: "2 - Ù†Ø§Ø²Ù„ (Downsloping)"
                         }[x])

    ca = st.selectbox("ğŸ«€ Major Vessels (CA) | Ø¹Ø¯Ø¯ Ø§Ù„Ø´Ø±Ø§ÙŠÙŠÙ† Ø§Ù„Ù…Ø³Ø¯ÙˆØ¯Ø© (0 = Ø³Ù„ÙŠÙ…)", [0, 1, 2, 3],
                      format_func=lambda x: f"{x} - {'Ø³Ù„ÙŠÙ…' if x == 0 else f'{x} Ø´Ø±ÙŠØ§Ù† Ù…ØªØ£Ø«Ø±'}")

    thal = st.selectbox("ğŸ§¬ Thalassemia | Ø§Ù„Ø«Ù„Ø§Ø³ÙŠÙ…ÙŠØ§ (0 = Normal)", [0, 1, 2],
                        format_func=lambda x: {
                            0: "0 - Ø·Ø¨ÙŠØ¹ÙŠ (Normal)",
                            1: "1 - Ø®Ù„Ù„ Ø«Ø§Ø¨Øª (Fixed Defect)",
                            2: "2 - Ø®Ù„Ù„ Ù…ØªØºÙŠØ± (Reversible Defect)"
                        }[x])

# ---------------- Prediction ----------------
if st.button("ğŸ” Predict"):
    input_data = np.array([[age, sex, cp, trestbps, chol,
                            fbs, restecg, thalch, exang, oldpeak, slope, ca, thal]])

    prediction = model.predict(input_data)[0]
    prob = model.predict_proba(input_data)[0][1] * 100

    st.markdown("### ğŸ“Š Prediction Result | Ø§Ù„Ù†ØªÙŠØ¬Ø©")

    if prob < 40:
        st.success(f"ğŸŸ© Low Risk ({prob:.2f}%) â€” Ø®Ø·Ø± Ù…Ù†Ø®ÙØ¶ | Ø§Ù„Ù…Ø±ÙŠØ¶ Ø¨ØµØ­Ø© Ø¬ÙŠØ¯Ø© ØºØ§Ù„Ø¨Ù‹Ø§")
        color = "#10B981"
    elif 40 <= prob <= 70:
        st.warning(f"ğŸŸ§ Medium Risk ({prob:.2f}%) â€” Ø®Ø·Ø± Ù…ØªÙˆØ³Ø· | ÙŠÙÙØ¶Ù„ Ø¹Ù…Ù„ ÙØ­ÙˆØµØ§Øª Ø¥Ø¶Ø§ÙÙŠØ©")
        color = "#FBBF24"
    else:
        st.error(f"ğŸŸ¥ High Risk ({prob:.2f}%) â€” Ø®Ø·Ø± Ù…Ø±ØªÙØ¹ | ÙŠÙÙ†ØµØ­ Ø¨Ù…Ø±Ø§Ø¬Ø¹Ø© Ø·Ø¨ÙŠØ¨ Ø§Ù„Ù‚Ù„Ø¨ ÙÙˆØ±Ù‹Ø§")
        color = "#EF4444"

    fig = go.Figure(go.Indicator(
        mode="gauge+number",
        value=prob,
        title={'text': "Heart Disease Risk (%) | Ù†Ø³Ø¨Ø© Ø®Ø·Ø± Ø£Ù…Ø±Ø§Ø¶ Ø§Ù„Ù‚Ù„Ø¨", 'font': {'size': 18}},
        gauge={
            'axis': {'range': [0, 100]},
            'bar': {'color': color},
            'steps': [
                {'range': [0, 40], 'color': "#6EE7B7"},
                {'range': [40, 70], 'color': "#FCD34D"},
                {'range': [70, 100], 'color': "#F87171"}
            ],
            'threshold': {'line': {'color': "black", 'width': 4}, 'value': prob}
        }
    ))
    st.plotly_chart(fig, use_container_width=True)

# ---------------- Footer ----------------
st.markdown("---")
st.caption("ğŸ‘¨â€ğŸ’» Developed by Kerolos Medhat | Heart Disease Prediction App")

